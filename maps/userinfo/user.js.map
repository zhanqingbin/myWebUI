/**
 *  @name:      redcore-webUI
 *  @version:   1.0.0
 *  @author:    redcore
 *  @desc:      redcore 内核webUI 页面开发
 *  @license:   ISC
 *  @copyright: Copyright 2018 The Redcore (Beijing) Technology Co.,Ltd. All rights reserved.
 */
{"version":3,"sources":["userinfo/user.js"],"names":["config","holder","login_status","pop_psw_nopermit","pop_psw_success","pop_modify_psw","_ins","Symbol","for","req_getUserInfo","init_rdc_user_html","init_evt","User","[object Object]","opt","Object","assign","this","document","getElementById","ins","chrome","send","user","avatarPath","$","attr","html","headName","email","next","append","mobile","companyName","department","title","click","top","location","href","userInfo","console","log","JSON","parse","screenSet","ScreenSet","rdc_user_device","Device","name","data","reload","setLockTime","errCode","initDOM","modifyPIN0","modifyPIN1","modifyPIN2","modifyPIN3","modifyPIN4","modifyPIN5","find","remove","getDeviceInfo","body","show","hide","op","val","np","cp"],"mappings":"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","file":"../../src/userinfo/user.js","sourcesContent":["// Copyright 2018 The Redcore (Beijing) Technology Co.,Ltd. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nconst config = {\n  holder: 'rdc_user',\n  login_status: '',\n  pop_psw_nopermit: `<div class=\"rdc-masker-content rdc-pos-mm\" style=\"padding-bottom:60px\">\n      <h5>修改密码</h5>\n      <p>很抱歉，非红芯SDP控制台本地认证用户，无权修改密码。</p>\n      <div class=\"rdc-ctl\" style=\"bottom: 20px; right:20px; top: unset\"> \n          <button id=\"btn_rdc_tocancel\" class=\"rdc-btn primary\"> 确认 </button> \n        </div> \n    </div>`,\n  pop_psw_success: `<div class=\"rdc-masker-content rdc-pos-mm\" style=\"padding-bottom:60px\">\n      <h5>修改密码</h5>\n      <p>密码修改成功，浏览器将自动退出，请重新登录。</p>\n      <div class=\"rdc-ctl\" style=\"bottom: 20px; right:20px; top: unset\"> \n          <button id=\"btn_rdc_toLoginout\" class=\"rdc-btn primary\"> 确认 </button> \n        </div> \n    </div>`,\n  pop_modify_psw: `<div id=\"rdc_pop_modify_psw\" class=\"rdc-masker-fix\">\n    <div class=\"rdc-masker-content rdc-pos-mm\">\n      <h5>修改密码</h5>\n      <div class=\"rdc-content rdc-pop\">\n        <div class=\"rdc-form-row\">\n          <label>请输入原密码</label> <input type=\"password\" placeholder=\"请输入原密码\" name=\"originalPSW\">\n        </div>\n        <div class=\"rdc-form-row\">\n          <label>请输入新密码</label> <input type=\"password\" placeholder=\"6-14位，至少包含英文字母及数字\" name=\"newPSW\">\n        </div>\n        <div class=\"rdc-form-row\">\n          <label>确认新密码</label> <input type=\"password\" placeholder=\"6-14位，至少包含英文字母及数字\" name=\"newPSWConfirm\">\n        </div>\n        <div class=\"rdc-form-valid\">\n          <span></span>\n        </div>\n        <div class=\"rdc-ctl-br\">\n          <button id=\"modify_psw_cancel\" class=\"rdc-btn\">取消</button>\n          <button id=\"modify_psw_ok\" class=\"rdc-btn primary\">确定</button>\n        </div>\n      </div>\n    </div>\n  </div>`\n}\nconst _ins = Symbol.for('UserIns')\nconst req_getUserInfo = Symbol.for('UserInfo')\nconst init_rdc_user_html = Symbol.for('init_rdc_user_html')\nconst init_evt = Symbol.for('UserInitEvt')\n\nclass User {\n  constructor(opt) {\n    if (opt) {\n      Object.assign(config, opt);\n    }\n    this.holder = document.getElementById(config.holder);\n    this[req_getUserInfo]();\n  }\n\n  static get ins() {\n    if (this[_ins] == null || !this[_ins]) {\n      this[_ins] = new User()\n    }\n    return this[_ins]\n  }\n\n  /**\n   * 从内核获取用户信息\n   */\n  [req_getUserInfo]() {\n    chrome.send(\"getUserInfo\");\n  }\n\n  [init_rdc_user_html](user) {\n    if (user.avatarPath) {\n      $('#rdc_user_head_img').attr('src', user.avatarPath)\n    }\n    $('#rdc_user_head_info').html(`<p>${user.headName || ''}</p> <p>${user.email || ''} </p>`)\n    $('#rdc_user_head_info').next().html(`<button class=\"rdc-btn-icon on\">\n              <span class=\"rdc-shadow\"></span>\n              <span class=\"rdc-caret-arrow rdc-pos-mm\"></span>\n            </button>`)\n    $('#rdc_user_info_holder').append(`<div class=\"rdc-content\"> \n            <div class=\"rdc-form-row\"> \n              <label>手机</label> <span>${user.mobile || ''}</span> \n            </div> \n            <div class=\"rdc-form-row\"> \n              <label>公司</label> <span>${user.companyName || ''}</span> \n            </div> \n            <div class=\"rdc-form-row\"> \n              <label>部门</label> <span>${user.department || ''}</span> \n            </div> \n            <div class=\"rdc-form-row\"> \n              <label>职位</label> <span>${user.title || ''}</span> \n            </div> \n            <div class=\"rdc-form-valid\"> \n              <span></span> \n            </div> \n            <div class=\"rdc-ctl-br\"> \n              <button id=\"btn_rdc_loginout\" class=\"rdc-btn\">退出登录</button> \n              <button id=\"btn_rdc_modify_psw\" class=\"rdc-btn primary\">修改密码</button> \n            </div> \n          </div> `)\n  }\n\n  /**\n   * 初始化事件注册\n   */\n  [init_evt]() {\n    let that = this;\n    $('#btn_rdc_login').click(function() {\n      top.location.href = \"chrome://newtab\"\n    })\n    $('#btn_rdc_loginout').click(function() {\n      chrome.send('logout');\n    })\n    $('#btn_rdc_modify_psw').click(function() {\n      chrome.send('checkIfCanModifyPassword')\n    })\n    $('#btn_rdc_upload_user_img').click(function() {\n\n    })\n  }\n\n\n\n  static getUserInfoFinish(userInfo) {\n    console.log(userInfo)\n    if (userInfo) {\n      let user = JSON.parse(userInfo);\n      this[_ins][init_rdc_user_html](user);\n      // 初始化锁屏设置\n      this.screenSet = new ScreenSet();\n      // 初始化用户设备\n      this.rdc_user_device = new Device({ user: { name: user.headName } });\n    }\n    this[_ins][init_evt]()\n  }\n\n  static loginFinish(data) {\n    console.log('login finish')\n  }\n\n  static logoutFinish() {\n    console.log('loginout finish')\n    top.location.reload()\n  }\n\n  static getLockScreenTimeFinish(data) {\n    console.log(`core lock screen time data`)\n    console.log(data)\n    this.screenSet.setLockTime(data);\n  }\n\n  static getDeviceInfoFinish(data) {\n    console.log('core Device data')\n    console.log(data)\n    if (typeof data === 'string') {\n      data = JSON.parse(data)\n    }\n    if (data.errCode === '0') {\n      this.rdc_user_device.initDOM(data)\n    }\n  }\n\n  /**\n   * @param  {[type]}\n   * @return {[type]}\n   */\n  static modifyPINCodeFinish(data) {\n    console.log(data)\n    switch (data) {\n      case 0:\n        {\n          // 成功\n          this.screenSet.modifyPIN0();\n          break;\n        }\n      case 1:\n        {\n          // 某项为空\n          this.screenSet.modifyPIN1();\n          break;\n        }\n      case 2:\n        {\n          // 原始锁屏密码不正确\n          this.screenSet.modifyPIN2();\n          break;\n        }\n      case 3:\n        {\n          // 锁屏密码和确认锁屏密码不一致\n          this.screenSet.modifyPIN3();\n          break;\n        }\n      case 4:\n        {\n          // 锁屏密码不是6位数字\n          this.screenSet.modifyPIN4();\n          break;\n        }\n      case 5:\n        {\n          // 原始锁屏密码和新锁屏密码一致\n          this.screenSet.modifyPIN5();\n          break;\n        }\n    }\n  }\n\n  /**\n   * @param  {[string]} data [修改密码回调函数]\n   * @return {[none]}\n   */\n  static modifyPasswordFinish(data) {\n    console.log(data)\n    switch (data) {\n      case '0':\n        {\n          // 成功\n          $('#rdc_pop_modify_psw').html(config.pop_psw_success);\n          $('#btn_rdc_toLoginout').click(function() {\n            chrome.send('logout');\n          })\n          break;\n        }\n      case 'E5001':\n        {\n          $('#rdc_pop_modify_psw').find('.rdc-form-valid span').html('请重试')\n          break;\n        }\n      case 'E5002':\n        {\n          // 原始密码错误\n          $('#rdc_pop_modify_psw').find('.rdc-form-valid span').html('原始密码错误')\n          break;\n        }\n      case 'E5003':\n        {\n          // 抱歉，您非红芯SDP控制台本地认证用户，无权修改\n          $('#rdc_pop_modify_psw').html(config.pop_psw_nopermit);\n          $('#btn_rdc_tocancel').click(function() {\n            $('#rdc_pop_modify_psw').remove()\n          })\n          break;\n        }\n    }\n  }\n\n\n  /**\n   * @param  {[type]}\n   * @return {[string]} \n   * 正确返回值： {\"errCode\":\"0\"}\n   */\n  static deleteDeviceFinish(data) {\n    console.log(`core data for deleteDevice`)\n    data = JSON.parse(data)\n    if (data.errCode === '0') {\n      this.rdc_user_device.getDeviceInfo()\n    }\n  }\n\n  static checkIfCanModifyPasswordFinish(data) {\n    console.log('check modfify psw' + data)\n    if (data === 'true') {\n      $(document.body).append($(config.pop_modify_psw))\n      $('#rdc_pop_modify_psw').show()\n      $('#modify_psw_cancel').click(function() {\n        $('#rdc_pop_modify_psw').hide().remove();\n      })\n      $('#modify_psw_ok').click(function() {\n        let op = $('input[name=\"originalPSW\"]').val();\n        let np = $('input[name=\"newPSW\"]').val();\n        let cp = $('input[name=\"newPSWConfirm\"]').val();\n        if (!op || !np || !cp) {\n          return false;\n        }\n        if (np != cp) {\n          return false;\n        }\n        chrome.send('modifyPassword', [op, np])\n      })\n    } else {\n      $(document.body).append($(config.pop_modify_psw))\n      $('#rdc_pop_modify_psw').html(config.pop_psw_nopermit).show()\n      $('#btn_rdc_tocancel').click(function() {\n        $('#rdc_pop_modify_psw').remove()\n      })\n    }\n  }\n}\n"]}