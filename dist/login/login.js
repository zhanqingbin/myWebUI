/**
 *  @name:      redcore-webUI
 *  @version:   1.0.0
 *  @author:    redcore
 *  @desc:      redcore 内核webUI 页面开发
 *  @license:   ISC
 *  @copyright: Copyright 2018 The Redcore (Beijing) Technology Co.,Ltd. All rights reserved.
 */
function switchPage(e){if(e){$("#content").empty(),$("#content").append('<div class="nav" id="nav"> <div class="title"> <img alt="logo" class="logo" id="logo" src="./imgs/defaultLogo.png"/> </div> <div class="search-box" id="search-box"> <input id="search-input"class="field field-block"placeholder="搜索 web"/> <span id="search-btn" title="search"></span> </div> <div id="homePage"> <div class="company-title" id="company-title"> <h1 id="title"></h1> </div> <div class="nav-tabs" id="tab-wrap"> </div> <div class="peeler-pack"> <img id="skin_peeler" src="./imgs/appearancel_icon.png" alt=""> <p>换 肤</p> </div> <div id="peeler-nav" class="peeler-nav mini-peeler-nav"> <div class="peeler-container"> <div class="peeler-title"> <h3>外观设置</h3> <img id="peeler_close" src="./imgs/close_icon.png" alt=""> </div> <div class="peeler-content"> <h4>主页背景</h4> <ul id="list-unstyled"> <li> <img class="bg-li" id="bg-1" src="./imgs/background/abb-1.png"> <img class="selected" src="./imgs/selected_icon.png"> <p>迷夜（默认）</p> </li> <li> <img class="bg-li" id="bg-2" src="./imgs/background/abb-2.png"> <img class="selected" src="./imgs/selected_icon.png"> <p>星河</p> </li> <li> <img class="bg-li" id="bg-3" src="./imgs/background/abb-3.png"> <img class="selected" src="./imgs/selected_icon.png"> <p>绮梦</p> </li> <li> <img class="bg-li" id="bg-4" src="./imgs/background/abb-4.png"> <img class="selected" src="./imgs/selected_icon.png"> <p>莱茵</p> </li> <li> <img class="bg-li" id="bg-5" src="./imgs/background/abb-5.png"> <img class="selected" src="./imgs/selected_icon.png"> <p>极光</p> </li> <li> <img class="bg-li" id="bg-6" src="./imgs/background/abb-6.png"> <img class="selected" src="./imgs/selected_icon.png"> <p>都市</p> </li> <li> <img class="bg-li" id="bg-7" src="./imgs/background/abb-7.png"> <img class="selected" src="./imgs/selected_icon.png"> <p>峡谷</p> </li> <li> <img class="bg-li" id="bg-8" src="./imgs/background/abb-8.png"> <img class="selected" src="./imgs/selected_icon.png"> <p>星轨</p> </li> </ul> </div> </div> </div> </div> <div class="market" id="tab-wrap-market"> <div class="market-banner"></div> <div class="back-pack"> <img class="back" id="back_app" src="./imgs/back_normal_icon.png" alt=""> <p>返回</p> </div> <div class="market-container" id="market_container"> </div> </div> </div>');for(var i=localStorage.getItem("background")||"bg-1",s=0;s<$(".bg-li").length;s++)if($(".bg-li")[s].id==i){$("#"+i).next().show();break}$("#nav").css("background-image","url(./imgs/background/"+i+".png)"),$("#skin_peeler, #peeler_close").on("click",function(){$(".peeler-nav").hasClass("mini-peeler-nav")?($(".peeler-nav").removeClass("mini-peeler-nav"),$("#skin_peeler").hide(),$("#peeler_close").show()):($(".peeler-nav").addClass("mini-peeler-nav"),$("#skin_peeler").show(),$("#peeler_close").hide())}),$("#list-unstyled").on("click",".bg-li",function(){for(var e,i=0;i<$(".selected").length;i++)$(".selected").hide();$(this).next().show(),e=$(this).attr("id"),$("#nav").css("background-image","url(./imgs/background/"+e+".png)"),localStorage.setItem("background",e)}),search()}else $("#content").empty(),$("#content").append('<div id="login" class="login"> <div class="wrap"> <div class="wrap-left"></div> <div class="form" id="form"> <div class="company_domain" id="company_domain"> <h2>服务器地址</h2> <input id="domain" type="text" class="field field-block" placeholder="请输入Redcore服务器地址" pattern="S+" tip="" /> <p>忘记服务器地址？请联系您的企业管理员获取。</p> <button class="button block" id="next-btn" name="">确定</button> </div> <div class="company_userMessage" id="company_userMessage"> <img src="./imgs/login/qrcode.png" alt="扫码登录" id="QRcode"> <h2>账号登录</h2> <p class="userName-pack"> <img src="./imgs/login/user_icon.png"> <input id="userid" type="text" class="field field-block" placeholder="请输入您的邮箱或手机号" pattern="S+" tip="" /> </p> <p class="password-pack"> <img src="./imgs/login/password_icon.png"> <input id="password" type="password" class="field field-block" placeholder="请输入密码" pattern="S+" tip="" /> </p> <div class="setting setting-server"> <span id="server-setting" class="link"> 设置服务器地址 </span> </div> <div id="error-row" class="row"> <span class="error-tip" id="error-tip"></span> </div> <button class="button block" id="login-btn">登 录</button> <div class="setting"> <label class="checkbox-label"> <input type="checkbox" id="auto-login-checkbox" /> <span class="checkbox"></span> <span>自动登录</span> </label> <span class="forget" id="openTip">忘记密码？</span> </div> </div> <div class="company_QRcode" id="company_QRcode"> <img src="./imgs/login/back-user.png" alt="返回登录" id="back_login"> <h2>二维码登录</h2> <div id="code_pack"> <div id="qrcode_img"></div> <div id="code_tip" style=""> <img src="./imgs/login/scan.png" alt=""> </div> </div> <div id="code_pack_qrcodeInvalid" style="display: block"> <p>二维码已失效</p> <button class="button block refresh" id="refresh_qrcode">请点击刷新</button> </div> <div id="code_pack_qrcodeSuccess" style="display: none"> <img src="./imgs/login/qrcodeSuccess.png" alt=""> <p>扫描成功</p> <p>请在手机上确认登录</p> </div> <div id="error-row1" class="row code-row"> <span class="error-tip" id="error-tip1"></span> </div> <p id="app_tip">请使用 <span>红芯APP</span> 扫描二维码</p> <p class="app_group"> <img src="./imgs/login/Group.png" alt=""> </p> <p class="download"> <a href="https://www.redcore.cn/download/index.html">下载红芯APP</a> </p> </div> </div> <div class="forgetPassword" id="forgetPassword"> <p> 忘记密码? 请联系您的企业管理员， </p> <p> 企业管理员可在控制台修改您的密码。 </p> <p class="bottom"> <button id="closeTip">确定</button> </p> </div> </div> </div>')}function Login(){var e="",i=this;function s(e){this.$input=$(e),this.state=!1,this.$input.focus(function(){$(this).removeClass("error"),i.errorTip("")})}s.prototype.verify=function(){var e=this;this.$input.change(function(){var i=$(this).attr("pattern"),s=($(this).attr("tip"),$(this).val());RegExp(i).test(s)?e.state=!0:(e.state=!1,$(this).addClass("error"))})},s.prototype.val=function(e){return e&&(this.state=!0,this.$input.val(e)),this.$input.val()},this.domain=new s("#domain"),this.userid=new s("#userid"),this.password=new s("#password");var c=function(){if(i.userid.val())if(i.password.val()){var e=i.domain.val();e?/\/\//.test(e)||(e="http://"+e):e="https://api.redcore.cn",HOMEPROXY.login(e,i.userid.val(),i.password.val()),i.loading()}else i.errorTip("请输入密码");else i.errorTip("请输入个人账号")};$("#login-btn").click(function(){c()});var o=function(){2,$("#company_domain").hide(),$("#company_userMessage").show(),i.errorTip("")};$("#next-btn").click(function(){o()}),$("#server-setting").click(function(){$("#company_domain").show(),$("#company_userMessage").hide(),i.errorTip("")}),window.addEventListener("keydown",function(e){"block"===$("#company_userMessage").css("display")&&13==e.which&&c(),"none"!==$("#company_domain").css("display")&&13==e.which&&(i.errorTip(""),o())});window.__page_to_content_script__=function(e,i){var s=top.document.getElementById("btn_page_to_content_script");s.setAttribute("data-type","__page_to_content_script__"),s.setAttribute("data-url",e),s.setAttribute("data-deviceId",i),s.click()},document.getElementById("btn_content_script_to_page").addEventListener("click",function(e){switch(this.getAttribute("data-type")){case"__content_script_to_page___":var i=this.getAttribute("data-flag");"scanned"===i&&($("#code_pack").hide(),$("#code_pack_qrcodeInvalid").hide(),$("#code_pack_qrcodeSuccess").show()),"timeout"!==i&&"cancelled"!==i||($("#code_pack").hide(),$("#code_pack_qrcodeSuccess").hide(),$("#code_pack_qrcodeInvalid").show())}},!1);var t=new QRCode(document.getElementById("qrcode_img"),{width:150,height:150});$("#QRcode").click(function(){$("#code_pack").css("visibility","hidden"),e=i.domain.val()||"api.redcore.cn",window.__page_to_content_script__("http://"+e,deviceId),$("#code_pack_qrcodeInvalid").hide(),$("#code_pack_qrcodeSuccess").hide(),i.errorTip(""),$.ajax({method:"GET",url:"http://"+e+"/client/v3/push/qrlogin/qrcode?deviceId="+deviceId,success:function(e){$("#code_pack").css("display","flex"),$("#code_pack").css("visibility","visible");var s=JSON.parse(e);s.qrcode?(t.makeCode(s.qrcode),$("#qrcode_img").attr("title"," ")):i.errorTip("获取二维码失败 ")},error:function(e){i.errorTip("获取二维码失败 ");for(var s=0;s<$("#qrcode_img>img").length;s++)$("#qrcode_img>img")[s].style.display="none"}}),$("#company_QRcode").show(),$("#company_userMessage").hide(),$("#company_domain").hide()}),$("#refresh_qrcode").click(function(){$.ajax({method:"GET",url:"http://"+e+"/client/v3/push/qrlogin/qrcode?deviceId="+deviceId,success:function(e){var s=JSON.parse(e);s.qrcode?(t.makeCode(s.qrcode),$("#qrcode_img").attr("title"," "),$("#code_pack_qrcodeInvalid").hide(),$("#code_pack_qrcodeSuccess").hide(),$("#code_pack").css("display","flex")):i.errorTip("获取二维码失败 ")},error:function(e){i.errorTip("获取二维码失败 ")}})}),$("#back_login").click(function(){i.errorTip(""),$("#company_QRcode").hide(),$("#company_domain").hide(),$("#company_userMessage").show()}),$("#code_pack").mousemove(function(e){$("#code_tip").show()}),$("#code_pack").mouseleave(function(e){$("#code_tip").hide()}),$("#auto-login-checkbox").change(function(){HOMEPROXY.setAutoLogin(this.checked)}),$("#openTip").click(function(){$("#forgetPassword").show()}),$("#closeTip").click(function(){$("#forgetPassword").hide()})}Login.prototype.removeLoading=function(){$("#login-btn").text("登 录"),$("#login-btn").removeClass("login-button")},Login.prototype.loading=function(){$("#login-btn").text("登录中"),$("#login-btn").addClass("login-button")},Login.prototype.setLoginInfo=function(e){this.domain.val(e.domain),this.userid.val(e.userid)},Login.prototype.setAutoLoginStatus=function(e){document.querySelector("#auto-login-checkbox").checked=e},Login.prototype.errorTip=function(e){e?($("#error-row, #error-row1").css("background","#fee6e6"),$("#error-tip, #error-tip1").html('<img src="./imgs/error_icon.png" alt="">'+e)):($("#error-row, #error-row1").css("background","none"),$("#error-tip, #error-tip1").html(""))};