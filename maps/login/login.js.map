/**
 *  @name:      redcore-webUI
 *  @version:   1.0.0
 *  @author:    redcore
 *  @desc:      redcore 内核webUI 页面开发
 *  @license:   ISC
 *  @copyright: Copyright 2018 The Redcore (Beijing) Technology Co.,Ltd. All rights reserved.
 */
{"version":3,"sources":["login/login.js"],"names":["switchPage","isLogin","$","empty","append","bgId","localStorage","getItem","i","length","id","next","show","css","on","hasClass","removeClass","hide","addClass","thisID","this","attr","setItem","search","Login","serverAddress","_this","Validator","$input","state","focus","errorTip","prototype","verify","_","change","pattern","value","val","RegExp","test","data","domain","userid","password","loginServer","HOMEPROXY","login","loading","click","domainVer","window","addEventListener","e","which","__page_to_content_script__","url","deviceId","proxy","top","document","getElementById","setAttribute","getAttribute","flag","qrcode","QRCode","width","height","ajax","method","success","res","resData","JSON","parse","makeCode","error","err","style","display","mousemove","mouseleave","setAutoLogin","checked","removeLoading","text","setLoginInfo","setAutoLoginStatus","querySelector","html"],"mappings":"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","file":"../../src/login/login.js","sourcesContent":["/**\r\n * if login, directly show Nav page\r\n */\r\nfunction switchPage(isLogin) {\r\n  if (isLogin) {\r\n    // 已经登录\r\n    $('#content').empty();\r\n    $('#content').append('<div class=\"nav\" id=\"nav\"> <div class=\"title\"> <img alt=\"logo\" class=\"logo\" id=\"logo\" src=\"./imgs/defaultLogo.png\"/> </div> <div class=\"search-box\" id=\"search-box\"> <input id=\"search-input\"class=\"field field-block\"placeholder=\"搜索 web\"/> <span id=\"search-btn\" title=\"search\"></span> </div> <div id=\"homePage\"> <div class=\"company-title\" id=\"company-title\"> <h1 id=\"title\"></h1> </div> <div class=\"nav-tabs\" id=\"tab-wrap\"> </div> <div class=\"peeler-pack\"> <img id=\"skin_peeler\" src=\"./imgs/appearancel_icon.png\" alt=\"\"> <p>换 肤</p> </div> <div id=\"peeler-nav\" class=\"peeler-nav mini-peeler-nav\"> <div class=\"peeler-container\"> <div class=\"peeler-title\"> <h3>外观设置</h3> <img id=\"peeler_close\" src=\"./imgs/close_icon.png\" alt=\"\"> </div> <div class=\"peeler-content\"> <h4>主页背景</h4> <ul id=\"list-unstyled\"> <li> <img class=\"bg-li\" id=\"bg-1\" src=\"./imgs/background/abb-1.png\"> <img class=\"selected\" src=\"./imgs/selected_icon.png\"> <p>迷夜（默认）</p> </li> <li> <img class=\"bg-li\" id=\"bg-2\" src=\"./imgs/background/abb-2.png\"> <img class=\"selected\" src=\"./imgs/selected_icon.png\"> <p>星河</p> </li> <li> <img class=\"bg-li\" id=\"bg-3\" src=\"./imgs/background/abb-3.png\"> <img class=\"selected\" src=\"./imgs/selected_icon.png\"> <p>绮梦</p> </li> <li> <img class=\"bg-li\" id=\"bg-4\" src=\"./imgs/background/abb-4.png\"> <img class=\"selected\" src=\"./imgs/selected_icon.png\"> <p>莱茵</p> </li> <li> <img class=\"bg-li\" id=\"bg-5\" src=\"./imgs/background/abb-5.png\"> <img class=\"selected\" src=\"./imgs/selected_icon.png\"> <p>极光</p> </li> <li> <img class=\"bg-li\" id=\"bg-6\" src=\"./imgs/background/abb-6.png\"> <img class=\"selected\" src=\"./imgs/selected_icon.png\"> <p>都市</p> </li> <li> <img class=\"bg-li\" id=\"bg-7\" src=\"./imgs/background/abb-7.png\"> <img class=\"selected\" src=\"./imgs/selected_icon.png\"> <p>峡谷</p> </li> <li> <img class=\"bg-li\" id=\"bg-8\" src=\"./imgs/background/abb-8.png\"> <img class=\"selected\" src=\"./imgs/selected_icon.png\"> <p>星轨</p> </li> </ul> </div> </div> </div> </div> <div class=\"market\" id=\"tab-wrap-market\"> <div class=\"market-banner\"></div> <div class=\"back-pack\"> <img class=\"back\" id=\"back_app\" src=\"./imgs/back_normal_icon.png\" alt=\"\"> <p>返回</p> </div> <div class=\"market-container\" id=\"market_container\"> </div> </div> </div>'); \r\n    var bgId = localStorage.getItem('background') || 'bg-1';\r\n    for (var i = 0; i < $('.bg-li').length; i ++) {\r\n        if ($('.bg-li')[i].id == bgId) {\r\n            $('#' + bgId).next().show();\r\n            break;\r\n        }\r\n    }\r\n    $('#nav').css(\"background-image\",\"url(./imgs/background/\"+ bgId +\".png)\");\r\n    // 换肤开始——————————————————————————————————————————————————————\r\n    $('#skin_peeler, #peeler_close').on('click',function(){\r\n        if (!$('.peeler-nav').hasClass('mini-peeler-nav')) {\r\n            $('.peeler-nav').addClass('mini-peeler-nav');\r\n            $('#skin_peeler').show();\r\n            $('#peeler_close').hide();\r\n        }else{\r\n            $('.peeler-nav').removeClass('mini-peeler-nav');\r\n            $('#skin_peeler').hide();\r\n            $('#peeler_close').show();\r\n        }\r\n    });\r\n\r\n    $('#list-unstyled').on('click','.bg-li',function(){\r\n        var thisID = ''\r\n        for (var i = 0; i < $('.selected').length; i ++) {\r\n            $('.selected').hide();\r\n        }\r\n        $(this).next().show();\r\n        thisID = $(this).attr(\"id\");\r\n\r\n        $('#nav').css(\"background-image\",\"url(./imgs/background/\"+ thisID +\".png)\");\r\n        localStorage.setItem('background', thisID);\r\n    })\r\n    // 换肤结束——————————————————————————————————————————————————————\r\n\tsearch();\r\n\r\n  } else {\r\n    $('#content').empty();\r\n    $('#content').append('<div id=\"login\" class=\"login\"> <div class=\"wrap\"> <div class=\"wrap-left\"></div> <div class=\"form\" id=\"form\"> <div class=\"company_domain\" id=\"company_domain\"> <h2>服务器地址</h2> <input id=\"domain\" type=\"text\" class=\"field field-block\" placeholder=\"请输入Redcore服务器地址\" pattern=\"\\S+\" tip=\"\" /> <p>忘记服务器地址？请联系您的企业管理员获取。</p> <button class=\"button block\" id=\"next-btn\" name=\"\">确定</button> </div> <div class=\"company_userMessage\" id=\"company_userMessage\"> <img src=\"./imgs/login/qrcode.png\" alt=\"扫码登录\" id=\"QRcode\"> <h2>账号登录</h2> <p class=\"userName-pack\"> <img src=\"./imgs/login/user_icon.png\"> <input id=\"userid\" type=\"text\" class=\"field field-block\" placeholder=\"请输入您的邮箱或手机号\" pattern=\"\\S+\" tip=\"\" /> </p> <p class=\"password-pack\"> <img src=\"./imgs/login/password_icon.png\"> <input id=\"password\" type=\"password\" class=\"field field-block\" placeholder=\"请输入密码\" pattern=\"\\S+\" tip=\"\" /> </p> <div class=\"setting setting-server\"> <span id=\"server-setting\" class=\"link\"> 设置服务器地址 </span> </div> <div id=\"error-row\" class=\"row\"> <span class=\"error-tip\" id=\"error-tip\"></span> </div> <button class=\"button block\" id=\"login-btn\">登 录</button> <div class=\"setting\"> <label class=\"checkbox-label\"> <input type=\"checkbox\" id=\"auto-login-checkbox\" /> <span class=\"checkbox\"></span> <span>自动登录</span> </label> <span class=\"forget\" id=\"openTip\">忘记密码？</span> </div> </div> <div class=\"company_QRcode\" id=\"company_QRcode\"> <img src=\"./imgs/login/back-user.png\" alt=\"返回登录\" id=\"back_login\"> <h2>二维码登录</h2> <div id=\"code_pack\"> <div id=\"qrcode_img\"></div> <div id=\"code_tip\" style=\"\"> <img src=\"./imgs/login/scan.png\" alt=\"\"> </div> </div> <div id=\"code_pack_qrcodeInvalid\" style=\"display: block\"> <p>二维码已失效</p> <button class=\"button block refresh\" id=\"refresh_qrcode\">请点击刷新</button> </div> <div id=\"code_pack_qrcodeSuccess\" style=\"display: none\"> <img src=\"./imgs/login/qrcodeSuccess.png\" alt=\"\"> <p>扫描成功</p> <p>请在手机上确认登录</p> </div> <div id=\"error-row1\" class=\"row code-row\"> <span class=\"error-tip\" id=\"error-tip1\"></span> </div> <p id=\"app_tip\">请使用 <span>红芯APP</span> 扫描二维码</p> <p class=\"app_group\"> <img src=\"./imgs/login/Group.png\" alt=\"\"> </p> <p class=\"download\"> <a href=\"https://www.redcore.cn/download/index.html\">下载红芯APP</a> </p> </div> </div> <div class=\"forgetPassword\" id=\"forgetPassword\"> <p> 忘记密码? 请联系您的企业管理员， </p> <p> 企业管理员可在控制台修改您的密码。 </p> <p class=\"bottom\"> <button id=\"closeTip\">确定</button> </p> </div> </div> </div>'); }\r\n}\r\n\r\n/*\r\n* Login module Constructor\r\n*/\r\nfunction Login() {\r\n    // deviceId = '1111';\r\n    var serverAddress = '';\r\n    var _this = this;\r\n    var step = 1;\r\n    // Input-Validator Constructor\r\n    function Validator(id) {\r\n      this.$input = $(id);\r\n      this.state = false;\r\n  \r\n      this.$input.focus(function() {\r\n        $(this).removeClass('error')\r\n        _this.errorTip('')\r\n      })\r\n    }\r\n  \r\n    Validator.prototype.verify = function() {\r\n      var _ = this;\r\n\r\n      this.$input.change(function() {\r\n        var pattern = $(this).attr('pattern')\r\n        var tip = $(this).attr('tip')\r\n        var value = $(this).val()\r\n        if (!RegExp(pattern).test(value)) {\r\n          _.state = false\r\n          $(this).addClass('error')\r\n        } else {\r\n          _.state = true\r\n        }\r\n      })\r\n    }\r\n\r\n    Validator.prototype.val = function(data) {\r\n      if (data) {\r\n        this.state = true\r\n        this.$input.val(data)\r\n      }\r\n      return this.$input.val()\r\n    }\r\n  \r\n    this.domain = new Validator('#domain')\r\n    this.userid = new Validator('#userid')\r\n    this.password = new Validator('#password')\r\n\r\n    // login\r\n    var loginServer = function () {\r\n\r\n        if (!_this.userid.val()) {\r\n            _this.errorTip('请输入个人账号');\r\n            return;\r\n        }\r\n        if (!_this.password.val()) {\r\n            _this.errorTip('请输入密码');\r\n            return;\r\n        }\r\n        var domain = _this.domain.val()\r\n        if (domain) {\r\n            if (!/\\/\\//.test(domain)) {\r\n                domain = 'http://' + domain\r\n            }\r\n        } else {\r\n\t\t\t// 正式地址\r\n            domain = 'https://api.redcore.cn'\r\n\t\t\t\r\n\t\t\t// 测试地址\r\n\t\t\t//domain = 'http://api.enterplorer.net'\r\n        }\r\n        HOMEPROXY.login(domain, _this.userid.val(), _this.password.val());\r\n        _this.loading();\r\n    }\r\n\r\n    // 登录操作\r\n    $('#login-btn').click(function() {\r\n      loginServer();\r\n    });\r\n\r\n    var domainVer = function () {\r\n        step = 2;\r\n        $('#company_domain').hide();\r\n        $('#company_userMessage').show();\r\n        _this.errorTip('');\r\n    }\r\n    // 填入企业域名点击下一步\r\n    $('#next-btn').click(function() {\r\n        domainVer();\r\n    });\r\n\r\n    // 设置服务器地址\r\n    $('#server-setting').click(function() {\r\n        $('#company_domain').show();\r\n        $('#company_userMessage').hide();\r\n        _this.errorTip('');\r\n    })\r\n\r\n    // 返回上一步添加企业域名\r\n    // $('#domain-back').click(function() {\r\n    //     step = 1;\r\n    //     _this.errorTip('');\r\n    //     $('#company_domain').show();\r\n    //     $('#company_userMessage').hide();\r\n    // })\r\n\r\n    // 回车登录\r\n    window.addEventListener('keydown', function (e) {\r\n      if ($('#company_userMessage').css('display') === \"block\" && e.which == 13) {\r\n          loginServer();\r\n      }\r\n        if ($('#company_domain').css('display') !== \"none\" && e.which == 13) {\r\n            _this.errorTip('');\r\n            domainVer();\r\n        }\r\n    })\r\n\r\n    // scan a QR code for login\r\n    // 通过隐藏按钮来 设置 页面js和content_script的通信\r\n    var getProxyEl = function () {\r\n        return top.document.getElementById('btn_page_to_content_script');\r\n    };\r\n    // 在dom中写入数据\r\n    window.__page_to_content_script__ = function (url, deviceId) {\r\n        var proxy = getProxyEl();\r\n        proxy.setAttribute('data-type', '__page_to_content_script__');\r\n        proxy.setAttribute('data-url', url);\r\n        proxy.setAttribute('data-deviceId', deviceId);\r\n        proxy.click();\r\n    };\r\n\r\n    // 接收来自 content_script的 信息\r\n    document.getElementById('btn_content_script_to_page').addEventListener('click', function (e) {\r\n        var type = this.getAttribute('data-type');\r\n        switch (type) {\r\n            case '__content_script_to_page___':\r\n                var flag = this.getAttribute('data-flag');\r\n                // 扫码成功\r\n                if (flag === 'scanned') {\r\n\r\n                    $('#code_pack').hide();\r\n                    $('#code_pack_qrcodeInvalid').hide();\r\n                    $('#code_pack_qrcodeSuccess').show();\r\n                }\r\n                // 过期\r\n                if (flag === 'timeout' || flag === 'cancelled') {\r\n                    $('#code_pack').hide();\r\n                    $('#code_pack_qrcodeSuccess').hide();\r\n                    $('#code_pack_qrcodeInvalid').show();\r\n                }\r\n                break;\r\n        }\r\n    }, false);\r\n\r\n    // 生成二维码\r\n    var qrcode = new QRCode(document.getElementById(\"qrcode_img\"), {\r\n        width : 150,\r\n        height : 150\r\n    });\r\n    // 点击二维码\r\n    $('#QRcode').click(function() {\r\n        $('#code_pack').css('visibility', 'hidden');\r\n        serverAddress = _this.domain.val() || 'api.redcore.cn';\r\n        // 建立长连接\r\n        window.__page_to_content_script__('http://' + serverAddress, deviceId);\r\n        $('#code_pack_qrcodeInvalid').hide();\r\n        $('#code_pack_qrcodeSuccess').hide();\r\n        _this.errorTip('');\r\n        // 获取二维码\r\n        $.ajax({\r\n            method: \"GET\",\r\n            url: \"http://\" + serverAddress + '/client/v3/push/qrlogin/qrcode?deviceId=' + deviceId,\r\n            success: function(res) {\r\n                $('#code_pack').css('display', 'flex');\r\n                $('#code_pack').css('visibility', 'visible');\r\n                var resData = JSON.parse(res);\r\n                if (resData.qrcode) {\r\n                    qrcode.makeCode(resData.qrcode);\r\n                    $('#qrcode_img').attr(\"title\",\" \");\r\n                } else {\r\n                    _this.errorTip('获取二维码失败 ');\r\n                }\r\n            },\r\n            error: function(err) {\r\n                _this.errorTip('获取二维码失败 ');\r\n                for (var i = 0; i < $(\"#qrcode_img>img\").length; i ++) {\r\n                    $(\"#qrcode_img>img\")[i].style.display = 'none'\r\n                }\r\n            }\r\n        });\r\n        $('#company_QRcode').show();\r\n        $('#company_userMessage').hide();\r\n        $('#company_domain').hide();\r\n    });\r\n\r\n    // 刷新重新获取二维码\r\n    $('#refresh_qrcode').click(function() {\r\n        $.ajax({\r\n            method: \"GET\",\r\n            url: \"http://\" + serverAddress + '/client/v3/push/qrlogin/qrcode?deviceId=' + deviceId,\r\n            success: function(res) {\r\n\t\t\t\tvar resData = JSON.parse(res);\r\n                if (resData.qrcode) {\r\n                    qrcode.makeCode(resData.qrcode);\r\n                    $('#qrcode_img').attr(\"title\",\" \");\r\n\t\t\t\t\t$('#code_pack_qrcodeInvalid').hide();\r\n                    $('#code_pack_qrcodeSuccess').hide();\r\n                    $('#code_pack').css('display', 'flex');\r\n                } else {\r\n                    _this.errorTip('获取二维码失败 ');\r\n                }\r\n            },\r\n            error: function(err) {\r\n                _this.errorTip('获取二维码失败 ');\r\n            }\r\n        });\r\n    });\r\n\r\n    // 返回\r\n    $('#back_login').click(function() {\r\n        _this.errorTip('');\r\n        $('#company_QRcode').hide();\r\n        $('#company_domain').hide();\r\n        $('#company_userMessage').show();\r\n    });\r\n\r\n    $('#code_pack').mousemove(function(e){\r\n        $('#code_tip').show();\r\n    });\r\n    $('#code_pack').mouseleave(function(e){\r\n        $('#code_tip').hide();\r\n    });\r\n\r\n    // 设置自动登录\r\n    $('#auto-login-checkbox').change(function() {\r\n      HOMEPROXY.setAutoLogin(this.checked)\r\n    })\r\n\r\n    // 打开提示忘记密码弹框\r\n    $('#openTip').click(function () {\r\n        $('#forgetPassword').show();\r\n    });\r\n    $('#closeTip').click(function () {\r\n        $('#forgetPassword').hide();\r\n    });\r\n\r\n}\r\n\r\n\r\n// ++++++++++++++++++++\r\n// LOGIN = new Login();\r\n/**\r\n * handle loading status\r\n */\r\nLogin.prototype.removeLoading = function() {\r\n  $('#login-btn').text('登 录');\r\n  $('#login-btn').removeClass('login-button');\r\n}\r\nLogin.prototype.loading = function() {\r\n  $('#login-btn').text('登录中');\r\n  $('#login-btn').addClass('login-button');\r\n}\r\n\r\n/**\r\n * set default value\r\n * @param {*} data \r\n */\r\nLogin.prototype.setLoginInfo = function(data) {\r\n  this.domain.val(data.domain)\r\n  this.userid.val(data.userid)\r\n}\r\nLogin.prototype.setAutoLoginStatus = function(data) {\r\n  document.querySelector('#auto-login-checkbox').checked = data\r\n}\r\n/**\r\n * set error tip for user input\r\n * @param {string} error info\r\n */\r\nLogin.prototype.errorTip = function(data) {\r\n    if (data) {\r\n        $('#error-row, #error-row1').css('background', '#fee6e6');\r\n        $('#error-tip, #error-tip1').html(\"<img src=\\\"./imgs/error_icon.png\\\" alt=\\\"\\\">\" + data);\r\n    } else {\r\n        $('#error-row, #error-row1').css('background', 'none');\r\n        $('#error-tip, #error-tip1').html('');\r\n    }\r\n}"]}