/**
 *  @name:      redcore-webUI
 *  @version:   1.0.0
 *  @author:    redcore
 *  @desc:      redcore 内核webUI 页面开发
 *  @license:   ISC
 *  @copyright: Copyright 2018 The Redcore (Beijing) Technology Co.,Ltd. All rights reserved.
 */
const config={holder:"rdc_user",login_status:"",pop_psw_nopermit:'<div class="rdc-masker-content rdc-pos-mm" style="padding-bottom:60px">\n      <h5>修改密码</h5>\n      <p>很抱歉，非红芯SDP控制台本地认证用户，无权修改密码。</p>\n      <div class="rdc-ctl" style="bottom: 20px; right:20px; top: unset"> \n          <button id="btn_rdc_tocancel" class="rdc-btn primary"> 确认 </button> \n        </div> \n    </div>',pop_psw_success:'<div class="rdc-masker-content rdc-pos-mm" style="padding-bottom:60px">\n      <h5>修改密码</h5>\n      <p>密码修改成功，浏览器将自动退出，请重新登录。</p>\n      <div class="rdc-ctl" style="bottom: 20px; right:20px; top: unset"> \n          <button id="btn_rdc_toLoginout" class="rdc-btn primary"> 确认 </button> \n        </div> \n    </div>',pop_modify_psw:'<div id="rdc_pop_modify_psw" class="rdc-masker-fix">\n    <div class="rdc-masker-content rdc-pos-mm">\n      <h5>修改密码</h5>\n      <div class="rdc-content rdc-pop">\n        <div class="rdc-form-row">\n          <label>请输入原密码</label> <input type="password" placeholder="请输入原密码" name="originalPSW">\n        </div>\n        <div class="rdc-form-row">\n          <label>请输入新密码</label> <input type="password" placeholder="6-14位，至少包含英文字母及数字" name="newPSW">\n        </div>\n        <div class="rdc-form-row">\n          <label>确认新密码</label> <input type="password" placeholder="6-14位，至少包含英文字母及数字" name="newPSWConfirm">\n        </div>\n        <div class="rdc-form-valid">\n          <span></span>\n        </div>\n        <div class="rdc-ctl-br">\n          <button id="modify_psw_cancel" class="rdc-btn">取消</button>\n          <button id="modify_psw_ok" class="rdc-btn primary">确定</button>\n        </div>\n      </div>\n    </div>\n  </div>'},_ins=Symbol.for("UserIns"),req_getUserInfo=Symbol.for("UserInfo"),init_rdc_user_html=Symbol.for("init_rdc_user_html"),init_evt=Symbol.for("UserInitEvt");class User{constructor(n){n&&Object.assign(config,n),this.holder=document.getElementById(config.holder),this[req_getUserInfo]()}static get ins(){return null!=this[_ins]&&this[_ins]||(this[_ins]=new User),this[_ins]}[req_getUserInfo](){chrome.send("getUserInfo")}[init_rdc_user_html](n){n.avatarPath&&$("#rdc_user_head_img").attr("src",n.avatarPath),$("#rdc_user_head_info").html(`<p>${n.headName||""}</p> <p>${n.email||""} </p>`),$("#rdc_user_head_info").next().html('<button class="rdc-btn-icon on">\n              <span class="rdc-shadow"></span>\n              <span class="rdc-caret-arrow rdc-pos-mm"></span>\n            </button>'),$("#rdc_user_info_holder").append(`<div class="rdc-content"> \n            <div class="rdc-form-row"> \n              <label>手机</label> <span>${n.mobile||""}</span> \n            </div> \n            <div class="rdc-form-row"> \n              <label>公司</label> <span>${n.companyName||""}</span> \n            </div> \n            <div class="rdc-form-row"> \n              <label>部门</label> <span>${n.department||""}</span> \n            </div> \n            <div class="rdc-form-row"> \n              <label>职位</label> <span>${n.title||""}</span> \n            </div> \n            <div class="rdc-form-valid"> \n              <span></span> \n            </div> \n            <div class="rdc-ctl-br"> \n              <button id="btn_rdc_loginout" class="rdc-btn">退出登录</button> \n              <button id="btn_rdc_modify_psw" class="rdc-btn primary">修改密码</button> \n            </div> \n          </div> `)}[init_evt](){$("#btn_rdc_login").click(function(){top.location.href="chrome://newtab"}),$("#btn_rdc_loginout").click(function(){chrome.send("logout")}),$("#btn_rdc_modify_psw").click(function(){chrome.send("checkIfCanModifyPassword")}),$("#btn_rdc_upload_user_img").click(function(){})}static getUserInfoFinish(n){if(console.log(n),n){let o=JSON.parse(n);this[_ins][init_rdc_user_html](o),this.screenSet=new ScreenSet,this.rdc_user_device=new Device({user:{name:o.headName}})}this[_ins][init_evt]()}static loginFinish(n){console.log("login finish")}static logoutFinish(){console.log("loginout finish"),top.location.reload()}static getLockScreenTimeFinish(n){console.log("core lock screen time data"),console.log(n),this.screenSet.setLockTime(n)}static getDeviceInfoFinish(n){console.log("core Device data"),console.log(n),"string"==typeof n&&(n=JSON.parse(n)),"0"===n.errCode&&this.rdc_user_device.initDOM(n)}static modifyPINCodeFinish(n){switch(console.log(n),n){case 0:this.screenSet.modifyPIN0();break;case 1:this.screenSet.modifyPIN1();break;case 2:this.screenSet.modifyPIN2();break;case 3:this.screenSet.modifyPIN3();break;case 4:this.screenSet.modifyPIN4();break;case 5:this.screenSet.modifyPIN5()}}static modifyPasswordFinish(n){switch(console.log(n),n){case"0":$("#rdc_pop_modify_psw").html(config.pop_psw_success),$("#btn_rdc_toLoginout").click(function(){chrome.send("logout")});break;case"E5001":$("#rdc_pop_modify_psw").find(".rdc-form-valid span").html("请重试");break;case"E5002":$("#rdc_pop_modify_psw").find(".rdc-form-valid span").html("原始密码错误");break;case"E5003":$("#rdc_pop_modify_psw").html(config.pop_psw_nopermit),$("#btn_rdc_tocancel").click(function(){$("#rdc_pop_modify_psw").remove()})}}static deleteDeviceFinish(n){console.log("core data for deleteDevice"),"0"===(n=JSON.parse(n)).errCode&&this.rdc_user_device.getDeviceInfo()}static checkIfCanModifyPasswordFinish(n){console.log("check modfify psw"+n),"true"===n?($(document.body).append($(config.pop_modify_psw)),$("#rdc_pop_modify_psw").show(),$("#modify_psw_cancel").click(function(){$("#rdc_pop_modify_psw").hide().remove()}),$("#modify_psw_ok").click(function(){let n=$('input[name="originalPSW"]').val(),o=$('input[name="newPSW"]').val(),s=$('input[name="newPSWConfirm"]').val();return!!(n&&o&&s)&&(o==s&&void chrome.send("modifyPassword",[n,o]))})):($(document.body).append($(config.pop_modify_psw)),$("#rdc_pop_modify_psw").html(config.pop_psw_nopermit).show(),$("#btn_rdc_tocancel").click(function(){$("#rdc_pop_modify_psw").remove()}))}}